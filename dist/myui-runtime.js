/*!
 * myui-runtime v0.1.0
 * 
 * Copyright (C) 2017 Fraunhofer IAO
 * All rights reserved.
 * 
 * This software may be modified and distributed under the terms
 * of the Clear BSD license. See the LICENSE file for details.
 */
window.myui=function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(2),s=r(3),a=r(4);r.d(t,"AAIMBehavior",function(){return i.a}),r.d(t,"AAIMInterpreter",function(){return n.a}),r.d(t,"AAIMService",function(){return s.a}),r.d(t,"SituationFactory",function(){return a.a})},function(e,t,r){"use strict";t.a=class{constructor(e,t){this._factory=e,this._services=new Map,t&&this._services.set("",t),this._data=new Map,this._currentConfig=void 0}executeState(e){let t;(t=Array.isArray(e.parameters)?Promise.resolve(this._resolveParameters(e.parameters)):"object"==typeof e.parameters?this._callService(e.parameters):Promise.resolve([])).then(t=>{this._currentConfig===e?this._factory.refresh(e.situation,t,this._data):(this._factory.create(e.situation,t,this._data),this._currentConfig=e)})}executeTransition(e){return"object"==typeof e?this._callService(e):Promise.resolve()}registerService(e,t){if(!e||e.length<1)throw new Error("A service cannot be registered without a name.");if(!t||"function"!=typeof t.execute)throw new Error("Services are required to provide an 'execute' function.");if(this._services.has(e))throw new Error(`There is already a service named '${e}'.`);this._services.set(e,t)}_resolveParameters(e){let t=/\${(?:(\w+)|([\w\.]+))}/;return e.map(function(e){let r=t.exec(e);if(null!==r&&void 0!==r[1])return this._data.get(r[1]);if(null!==r&&void 0!==r[2]){let e=r[2].split("."),t=this._data.get(e[0]);for(let r=1;"object"==typeof t&&r<e.length;r++)t=t[e[r]];return t}return e},this)}_callService(e,t){if("object"!=typeof e||null===e)throw new Error("No service configuration object provided!");if(void 0===e.name||"string"!=typeof e.name||e.name.length<1)throw new Error("Invalid service configuration: 'name' is required!");if(e.service&&("string"!=typeof e.service||e.service.length<1))throw new Error("Invalid service configuration: 'service' has to be a non-empty string, if defined!");let r=this._services.get(e.service?e.service:"");if(!r)throw new Error("Invalid service configuration: There is no "+(e.service&&e.service.length>0?`service named '${e.service}'!`:"default service!"));if(!r.provides(e.name))throw new Error("Invalid service configuration: "+(e.service&&e.service.length>0?`Service '${e.service}'`:"Default service")+` does not provide a method '${e.name}'!`);let i;i=Array.isArray(e.parameters)?Promise.resolve(this._resolveParameters(e.parameters)):"object"==typeof e.parameters?this._callService(e.parameters).then(e=>Promise.resolve([e])):Array.isArray(t)?Promise.resolve(t):Promise.resolve([]),Array.isArray(e.parameterMapping)&&e.parameterMapping.length>0?i=Promise.all(e.parameters.map((t,r)=>"object"==typeof e.parameterMapping[r]&&null!==e.parameterMapping[r]?this._callService(e.parameterMapping[r],[t]):t)):e.parameters;let n=i.then(t=>r.execute(e.name,...t));return"object"==typeof e.resultMapping&&null!==e.resultMapping&&(n=n.then(t=>this._callService(e.resultMapping,[t]))),n}}},function(e,t,r){"use strict";t.a=class{constructor(e){this._behavior=e,this._running=!1,this._currentAAIM=void 0,this._currentState=void 0,this._loadedStates=void 0}get running(){return this._running}set running(e){e&&!this._running&&void 0!==this._currentAAIM?(this._running=!0,void 0===this._currentState&&("string"==typeof this._currentAAIM.initial&&this._loadedStates.has(this._currentAAIM.initial)?this._performTransition(this._loadedStates.get(this._currentAAIM.initial)):this._running=!1)):this._running=!1}get aaim(){return this._currentAAIM}get state(){return this._currentState}load(e){if(!this._running&&"object"==typeof e&&null!==e&&Array.isArray(e.states)&&e.states.length>0){this._currentAAIM=e,this._loadedStates=new Map;for(let e of this._currentAAIM.states)this._loadedStates.set(e.name,e);return!0}return!1}reset(){this._running||(this._currentState=void 0)}executeEvent(e){if(this._running)for(let t of this._currentState.events)if(t.on==e&&this._loadedStates.has(t.goto)){this._performTransition(this._loadedStates.get(t.goto),t.do);break}}_performTransition(e,t){this._currentState=e,t&&this._behavior?this._behavior.executeTransition(t).then(function(){this._behavior.executeState(e.do)}.bind(this)):this._behavior&&this._behavior.executeState(e.do)}}},function(e,t,r){"use strict";t.a=class{constructor(){this._functions=new Map}execute(e,...t){if(!this._functions.has(e))throw new Error(`Function '${e}' is not provided by this service.`);let r;try{return(r=this._functions.get(e).apply(this,t))instanceof Promise?r:new Promise(function(e,t){e(r)})}catch(e){return new Promise(function(t,r){r(e)})}}provides(e){return this._functions.has(e)}}},function(e,t,r){"use strict";t.a=class{constructor(){}create(e,t,r){}refresh(e,t,r){}}}]);
//# sourceMappingURL=myui-runtime.js.map